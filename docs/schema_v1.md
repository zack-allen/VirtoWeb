# VirtoWeb Schema v1 — Human-readable Specification

This document describes the unified JSON schema (v1) used by VirtoWeb as the single source of truth for generating projects across multiple backend languages.

## High-level contract

- Input: JSON file conforming to `virtoweb.schema.json` (draft-07)
- Output: Language-specific project generated by a backend that interprets this schema
- Error modes: validation failures (schema mismatch), missing templates, unresolved component/layout references

## Top-level sections

- `project` — metadata (id, title, version, basePath)
- `metadata` — arbitrary key/value metadata
- `assets` — files to copy into output (src → dest)
- `layouts` — reusable layout definitions (templates + regions)
- `components` — small reusable UI building blocks
- `pages` — route-to-layout mappings with region content
- `forms` — form definitions for secure handling
- `generator` — options for the generator (language, outputDir, variant)

---

## Layouts (detailed)

A `layout` is a reusable page-level template that defines:

- `id` (string): unique identifier referenced by pages
- `template` (string): name/path of the template file used by backends (e.g., `layouts/base.html`, `layouts/main.twig`)
- `regions` (array[string]): named regions (slots) that pages populate, e.g. `["head","header","main","sidebar","footer"]`
- `props` (object): default properties available to the layout template (e.g., default title, scripts)
- `default` (boolean): whether this layout is the fallback when a page omits a layout

Semantics:

- Backends must translate `template` into a language-appropriate template (Jinja2, Twig, Handlebars, plain HTML).
- During generation, pages supply an object `regions` mapping regionName -> ordered list of component instances. Each component instance maps to a `components` definition by `id`.
- Layout templates are responsible for rendering regions. For example, Jinja2 layout may iterate over `regions.header` to render header components.

Best practices:

- Keep region names stable across templates to allow template parity between languages.
- Keep layouts thin: layout should define global chrome (doctype, head tags, common assets) and provide slots only.

### Example layout semantics

Given layout `id: "main"` with `regions: ["head","header","main","footer"]`, a page can populate `regions.main` with a Hero component followed by content blocks. The backend will:

1. Resolve layout `main` -> template `layouts/main`.
2. Provide template context `{ project, page, regions, metadata }`.
3. Render components in order inside their regions.

---

## Pages

Each page must include `id`, `route`, `title`, and `layout`.
`route` supports parameter placeholders like `/posts/{slug}`. Backends must translate these into framework-specific route patterns.

---

## Components

Components are references to small reusable renderable pieces. Each component has:

- `id` (string)
- `type` (static/dynamic/form/nav/list/hero)
- `template` (string): template path/name used by backends
- `props`: default props

Component instances referenced by pages provide `props` which are merged with component defaults. Component templates receive `props` and may call forms or include other components.

---

## Forms

Forms are defined centrally and referenced by components. Generators must emit safe server-side handlers for form `action` endpoints. Default protection: enable CSRF for non-static generators.

---

## Generator options

Examples:

- `language`: `php`, `node`, `python`, or `static`
- `outputDir`: where to write the generated project
- `templateVariant`: optional theme/variant name

---

## Layout-specific example (see examples folder)

A minimal layout:

```json
{
  "id": "basic",
  "template": "layouts/basic",
  "regions": ["head","header","main","footer"],
  "props": {"siteTitle": "My Site"},
  "default": true
}
```

Backends should map `layouts/basic` to a real template file appropriate for the target language.

---

## Error handling

- Missing layout referenced by a page -> validation error.
- Component instance referencing unknown `component` -> validation error.
- Template path missing in output templates -> generator error.

---

## Next steps

- Add example site schemas (landing page, blog) — done in `examples/`.
- Implement core validator and AST converter next.
